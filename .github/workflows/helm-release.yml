name: Helm Chart Release

on:
  push:
    tags:
      - 'v*'

jobs:
  release:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup Go
        uses: actions/setup-go@v4
        with:
          go-version: '1.21'
      
      - name: Install controller-gen
        run: |
          go install sigs.k8s.io/controller-tools/cmd/controller-gen@latest
      
      - name: Generate CRDs
        run: make manifests
      
      - name: Copy CRDs to Helm chart
        run: make helm-crds
      
      - name: Setup Helm
        uses: azure/setup-helm@v3
        with:
          version: 'latest'
      
      - name: Lint Helm chart
        run: helm lint deployments/helm/kafka-backup-operator
      
      - name: Package Helm chart
        run: |
          helm package deployments/helm/kafka-backup-operator \
            --destination .deploy
      
      - name: Upload to chart repository
        run: |
          # Upload to your chart repository
          # Example: S3, ChartMuseum, Harbor, etc.